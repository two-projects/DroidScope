-- ================= CONFIG =================
local WEBHOOK_URLS = {
	"https://discord.com/api/webhooks/1440713503295148104/eTKQ8_1mYq0f42WwduNoo7F5d2WEWZGj4ei8joz1il--JpIlWjRUsnJ0PPRaRBAwPP5r"
}
local PRIVATE_SERVER = "https://www.roblox.com/share?code=aad142168d2e0c419085cc0679eb2ef3&type=Server"
local VERSION = "DroidScope | Classic v2.1.5"
local DEFAULT_THUMB = "https://i.ibb.co/S7X9mR6X/image-041fa2.png"

-- ================= SERVICES =================
local LogService = game:GetService("LogService")
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local VirtualUser = game:GetService("VirtualUser")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local player = Players.LocalPlayer
local HttpRequest = http and http.request or http_request or request or (syn and syn.request)

-- ================= BOOSTER =================
local function boostFPS()
    local decalsyeeted = true 
    local w = Workspace
    local l = Lighting
    local t = w.Terrain
    pcall(function()
        sethiddenproperty(l,"Technology",2)
        sethiddenproperty(t,"Decoration",false)
    end)
    t.WaterWaveSize = 0; t.WaterWaveSpeed = 0;
    t.WaterReflectance = 0; t.WaterTransparency = 0
    l.GlobalShadows = false; l.FogEnd = 9e9;
    l.Brightness = 0
    settings().Rendering.QualityLevel = "Level01"
end

-- ================= WEBHOOK =================
local function sendWebhook(payload)
	for _, url in ipairs(WEBHOOK_URLS) do
		pcall(function() 
            HttpRequest({
                Url = url, 
                Method = "POST", 
                Headers = {["Content-Type"]="application/json"}, 
                Body = HttpService:JSONEncode(payload)
            }) 
        end)
	end
end

-- ================= STATE =================
local macroRunning = false
local lastBiome = nil
local sessionStart = 0

-- ================= DETECTION =================
LogService.MessageOut:Connect(function(message)
    if not macroRunning then return end
    
    -- Detects biome from the "hoverText" in the Bloxstrap JSON log
    local biome = message:match('\"hoverText\":\"(.-)\"')
    
    if biome then
        biome = biome:upper()
        if biome ~= "NORMAL" and biome ~= lastBiome then
            lastBiome = biome
            sendWebhook({
                embeds = {{
                    title = "Biome Detected - " .. biome,
                    color = 0x3498DB,
                    thumbnail = {url = DEFAULT_THUMB},
                    fields = {
                        {name = "Account", value = player.Name, inline = true},
                        {name = "Server", value = PRIVATE_SERVER, inline = false}
                    },
                    footer = {text = VERSION}
                }}
            })
        end
    end
end)

-- ================= OLD GUI CODE =================
local gui = Instance.new("ScreenGui", player.PlayerGui)
gui.ResetOnSpawn = false
gui.Name = "DroidScope"

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.fromScale(0.42,0.16)
frame.Position = UDim2.fromScale(0.29,0.75)
frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
Instance.new("UICorner", frame).CornerRadius = UDim.new(0.15,0)

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.fromScale(1,0.35)
title.BackgroundTransparency = 1
title.Text = "DroidScope"
title.TextScaled = true
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.new(1,1,1)

local function btn(text,pos,color,cb)
	local b = Instance.new("TextButton", frame)
	b.Size = UDim2.fromScale(0.45,0.4)
	b.Position = pos
	b.Text = text
	b.TextScaled = true
	b.Font = Enum.Font.GothamBold
	b.BackgroundColor3 = color
	b.TextColor3 = Color3.new(1,1,1)
	Instance.new("UICorner", b).CornerRadius = UDim.new(0.2,0)
	b.Activated:Connect(cb)
end

btn("START", UDim2.fromScale(0.03,0.5), Color3.fromRGB(46,204,113), function()
	if macroRunning then return end
	macroRunning = true
    boostFPS()
	sessionStart = os.time()
	sendWebhook({
        embeds = {{
            title = ":bar_chart: DroidScope Started", 
            color = 0x3498DB, 
            fields = {{name = "Account", value = player.Name, inline = false}}, 
            footer = {text = VERSION}
        }}
    })
end)

btn("STOP", UDim2.fromScale(0.52,0.5), Color3.fromRGB(231,76,60), function()
	macroRunning = false
end)

-- Draggable Logic from Scripot.txt
local dragging, dragStart, startPos
frame.InputBegan:Connect(function(i) 
    if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then 
        dragging = true; dragStart = i.Position; startPos = frame.Position 
    end 
end)

UserInputService.InputChanged:Connect(function(i) 
    if dragging and (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) then 
        local d = i.Position - dragStart
        frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + d.X, startPos.Y.Scale, startPos.Y.Offset + d.Y) 
    end 
end)

UserInputService.InputEnded:Connect(function(i) 
    if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then 
        dragging = false 
    end 
end)

-- Anti-AFK
player.Idled:Connect(function() 
    VirtualUser:CaptureController()
    VirtualUser:ClickButton2(Vector2.new()) 
end)
